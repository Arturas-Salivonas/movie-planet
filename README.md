# filmingmap ğŸ¬ğŸŒ

> An interactive 3D globe visualization showing authentic filming locations from the world's greatest movies.

[![MapLibre GL JS](https://img.shields.io/badge/MapLibre-GL%20JS-blue)](https://maplibre.org/)
[![React](https://img.shields.io/badge/React-18-blue)](https://reactjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5-blue)](https://www.typescriptlang.org/)
[![Vite](https://img.shields.io/badge/Vite-5-purple)](https://vitejs.dev/)

## âœ¨ Features

- **ğŸŒ Interactive 3D Globe** - Smooth rotating globe with MapLibre GL JS
- **ğŸ¬ 677+ Movies** - Curated collection with accurate filming locations
- **ğŸ“ Verified Locations** - All locations scraped directly from IMDb
- **ğŸ” Smart Filtering** - Search and filter by genre, year, rating
- **ğŸ¯ Focus Mode** - Click "Show All on Map" to isolate a single movie's locations
- **ğŸ¨ Beautiful UI** - Circular movie posters, amber connecting lines, cinematic design
- **âš¡ Fast & Responsive** - Progressive loading with smooth animated progress bar
- **ğŸ’¾ Smart Caching** - PWA service worker caches everything (instant repeat visits)
- **ğŸ“¦ Clean Data Structure** - Just 2 files: database + input library
- **ğŸ”‡ Zero Console Noise** - Clean loading with fallback handlers (no warnings)

## ğŸš€ Quick Start

### Prerequisites

- Node.js 18+ and npm
- TMDb API key (free - [get one here](https://www.themoviedb.org/settings/api))

### Installation

1. **Clone the repository**
   ```bash
   git clone https://github.com/yourusername/filmingmap.git
   cd filmingmap
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Set up environment variables**
   ```bash
   cp .env.example .env
   ```

   Edit `.env` and add your TMDb API credentials:
   ```env
   TMDB_API_KEY=your_api_key_here
   TMDB_API_READ_ACCESS_TOKEN=your_token_here
   ```

4. **Run the development server**
   ```bash
   npm run dev
   ```

5. **Open your browser**
   ```
   http://localhost:3000
   ```

## ğŸ“¦ Project Structure

```
filmingmap/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Map.tsx           # 3D globe with MapLibre GL JS
â”‚   â”‚   â”œâ”€â”€ Filters.tsx       # Search and filter controls
â”‚   â”‚   â”œâ”€â”€ MovieModal.tsx    # Movie details popup
â”‚   â”‚   â””â”€â”€ SearchBar.tsx     # Movie search input
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ helpers.ts        # Filter and utility functions
â”‚   â”‚   â””â”€â”€ mapbox.ts         # Map styling utilities
â”‚   â”œâ”€â”€ types.ts              # TypeScript interfaces
â”‚   â”œâ”€â”€ App.tsx               # Main application
â”‚   â””â”€â”€ main.tsx              # Entry point
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ fetchAndTransform.ts     # Main fetch workflow (orchestrates everything)
â”‚   â”œâ”€â”€ fetchMoviesAuto.ts       # IMDb scraper + geocoder (Puppeteer)
â”‚   â”œâ”€â”€ cleanDuplicateLocations.ts # Removes duplicate filming locations
â”‚   â””â”€â”€ transform_to_geojson.ts  # Converts to GeoJSON for map
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ movies_input.json        # ğŸ“š LIBRARY: IMDb IDs to fetch (677 movies)
â”‚   â”œâ”€â”€ movies_enriched.json     # ğŸ—„ï¸ DATABASE: Full movie data (loads into DOM)
â”‚   â””â”€â”€ cache/                   # API response cache (TMDb + Geocoding)
â”œâ”€â”€ public/
â”‚   â””â”€â”€ geo/
â”‚       â””â”€â”€ movies.geojson       # Generated GeoJSON for map visualization
â””â”€â”€ package.json
```

### ğŸ“ Data Files Explained

**`movies_input.json`** - Movie Library (Input)
- List of IMDb IDs to fetch
- Add new movies here: `{"imdb_id": "tt1234567", "title": "Movie Name"}`
- Currently: 677 unique movies (no duplicates)

**`movies_enriched.json`** - Movie Database (Output)
- Complete movie data with locations, metadata, cast, etc.
- Generated by `npm run fetch`
- Loads into the DOM for visualization
- Currently: 299 movies with filming locations

**`cache/`** - API Response Cache
- Stores TMDb and geocoding results
- Prevents redundant API calls
- Safe to delete (will be regenerated)

## ğŸ› ï¸ Available Scripts

```bash
# Development
npm run dev              # Start dev server (http://localhost:3000)
npm run build            # Production build
npm run preview          # Preview production build

# Data Management
npm run fetch            # Fetch movies from movies_input.json (main command)
npm run fetch 50         # Fetch 50 movies from the input library
```

### ğŸ“¥ Adding New Movies

1. **Add IMDb IDs** to `data/movies_input.json`:
   ```json
   [
     {"imdb_id": "tt0111161", "title": "The Shawshank Redemption"},
     {"imdb_id": "tt0068646", "title": "The Godfather"}
   ]
   ```

2. **Run the fetcher**:
   ```bash
   npm run fetch 10    # Fetch 10 movies
   ```

3. **The script automatically**:
   - âœ… Scrapes IMDb for filming locations (Puppeteer)
   - âœ… Fetches movie metadata from TMDb
   - âœ… Geocodes all locations (Nominatim)
   - âœ… Removes duplicate locations
   - âœ… Converts to GeoJSON
   - âœ… Updates movies_enriched.json
   - âœ… Rebuilds the visualization

4. **Refresh your browser** - New movies appear instantly!

## ğŸ“Š How It Works

The entire workflow is automated through `npm run fetch`:

```bash
# Fetch 50 movies from movies_input.json
npm run fetch 50
```

**What happens behind the scenes:**

1. **ğŸ¯ Load Input Library** (`movies_input.json`)
   - Reads IMDb IDs from your library
   - Skips already-fetched movies

2. **ğŸ•·ï¸ Scrape IMDb** (Puppeteer + Headless Chrome)
   - Opens each movie's filming locations page
   - Extracts location names and descriptions
   - Handles rate limits automatically

3. **ğŸ“½ï¸ Fetch TMDb Metadata**
   - Gets title, year, poster, rating, genres, cast
   - Uses IMDb ID to find TMDb ID

4. **ğŸ—ºï¸ Geocode Locations** (Nominatim API)
   - Converts location names to coordinates
   - Caches all results locally
   - Respects 1.1s rate limit

5. **ğŸ§¹ Clean Duplicates**
   - Removes locations within 100m of each other
   - Keeps the most detailed description

6. **ğŸ”„ Transform to GeoJSON**
   - Converts movies_enriched.json â†’ movies.geojson
   - Optimized for MapLibre GL JS

7. **âœ… Done!**
   - Updates movies_enriched.json (database)
   - Refreshes the map automatically

## ğŸŒŸ Key Features

### ğŸŒ Globe Rotation
The globe automatically rotates slowly on page load. It stops when you interact with the map (drag, zoom, or click).

### ğŸ¯ Focus Mode
Click "Show All on Map" in any movie modal to:
- Hide all other movie markers
- Show only the selected movie's locations
- Display amber connecting lines between locations
- Center the map on those locations

### ğŸ“ Circular Markers
Movie posters are displayed as circular markers with:
- 60px diameter
- White borders
- Clean, modern aesthetic

### ğŸ’¾ Smart Caching
All API responses cached in `data/cache/`:
- **TMDb data**: `tmdb_movie_*.json`
- **IMDb locations**: `imdb_locations_*.json`
- **Geocoding**: `geocode_*.json`
- Prevents redundant API calls
- Safe to delete (regenerates automatically)

## ğŸ¬ Scaling to 1,000+ Movies

The system is designed to handle large-scale data collection:

**Current Status:**
- ğŸ“š Input Library: 677 unique movies (ready to fetch)
- ğŸ—„ï¸ Database: 299 movies with locations (already fetched)
- ğŸ¯ Remaining: 378 movies to fetch

**To fetch all remaining movies:**
```bash
npm run fetch 378
```

**Performance:**
- ~35-45 seconds per movie (IMDb scraping + geocoding)
- Progress saved continuously (resumable on crashes)
- All API calls cached (no redundant requests)
- **Estimated time for 378 movies**: ~4-5 hours

**To expand beyond 677:**
1. Add more IMDb IDs to `movies_input.json`
2. Run `npm run fetch <number>`
3. Done!

## ğŸ”‘ API Keys & Rate Limits

### TMDb API (Required)
- Free tier: 1,000 requests per day
- Get your key: https://www.themoviedb.org/settings/api
- Used for: Movie metadata (title, poster, year, rating)

### Nominatim Geocoding (Free)
- Rate limit: 1 request per second (hardcoded in scraper)
- No API key needed
- Used for: Converting location names to coordinates

### MapLibre GL JS (Free)
- No API key required
- Uses OpenStreetMap data
- Completely free and open-source

## ğŸ¤ Contributing

This is a personal project, but suggestions and improvements are welcome!

## ğŸ“ License

MIT License

## ğŸ™ Acknowledgments

- **IMDb** - Filming location data
- **TMDb** - Movie metadata and posters
- **OpenStreetMap** - Map data via MapLibre GL JS
- **Nominatim** - Geocoding service

---

**Made with â¤ï¸ for cinema and cartography**
